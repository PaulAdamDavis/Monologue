<script>
    (function(window, document, undefined) {
        "use strict";

        var players = ['iframe[src*="youtube.com"]', 'iframe[src*="vimeo.com"]'];
        var fitVids = document.querySelectorAll(players.join(","));

        if (fitVids.length) {
            for (var i = 0; i < fitVids.length; i++) {
                var fitVid = fitVids[i];
                var width = fitVid.getAttribute("width");
                var height = fitVid.getAttribute("height");
                var aspectRatio = height / width;
                var parentDiv = fitVid.parentNode;

                var div = document.createElement("div");
                div.className = "fitVids-wrapper";
                div.style.paddingBottom = aspectRatio * 100 + "%";
                parentDiv.insertBefore(div, fitVid);
                fitVid.remove();
                div.appendChild(fitVid);

                fitVid.removeAttribute("height");
                fitVid.removeAttribute("width");
            }
        }
    })(window, document);

    (function (window, document) {
        var resizeImagesInGalleries = function resizeImagesInGalleries() {
            var images = document.querySelectorAll('.kg-gallery-image img');
            images.forEach(function (image) {
                var container = image.closest('.kg-gallery-image');
                var width = image.attributes.width.value;
                var height = image.attributes.height.value;
                var ratio = width / height;
                container.style.flex = ratio + ' 1 0%';
            });
        };

        document.addEventListener('DOMContentLoaded', resizeImagesInGalleries);
    })(window, document);
</script>

{{!-- https://github.com/francoischalifour/medium-zoom --}}
<script src="https://unpkg.com/medium-zoom@1.0.5/dist/medium-zoom.min.js"></script>
<script>
    mediumZoom('.kg-gallery-image img', {
        scrollOffset: 5
    });
</script>
<style>
    .medium-zoom-overlay {
        background: none !important;
    }
    .medium-zoom-overlay:before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: var(--color-background) !important;
        opacity: 0.9;
    }
</style>

<script>
    function theme() {
        const html = document.documentElement;
        const toggle = document.querySelector('.js-theme-toggle');

        const setTheme = (type = 'system') => {
            html.classList.remove('theme-dark', 'theme-system', 'theme-light');
            html.classList.add(`theme-${type}`);
            localStorage.setItem('monologue_theme', type);
            toggle.innerText = toggle.getAttribute(`data-${type}-label`);
        }

        setTheme(localStorage.getItem('monologue_theme') || undefined);

        toggle.addEventListener('click', (e) => {
            e.preventDefault();

            if (!html.classList.contains('theme-dark') && !html.classList.contains('theme-light')) {
                setTheme('dark');
            } else if (html.classList.contains('theme-dark')) {
                setTheme('light');
            } else {
                setTheme('system');
            }
        });
    }
    theme();
</script>
